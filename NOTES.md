# Notes for the project
The information in this file will help developers on how to build, test and update the project


## Project structure
Here is a summary of the project structure

- `dist\` contains the distribution files. These are generated by the build script and include ES modules and Common JS versions  
- `src\` contains the source files  
    - `src\njk\` contain the nunjucks source base and macros
    - `src\templates\` contain the template files used to build the html files
- `test\` contains the scripts for testing 
- `app.mjs` express router 

## Running
Loads up express to review the test rendered HTML on local host.

Run `npm start`.

## Building

Generates the distribution files, which includes the package's ES modules and Common JS versions  

Run `npm run build`

## Testing
### Unit tests
Checks the HTML structure of the generated files are as expected.

Run `npm test`

## Deployment
Here's a checklist to follow when releasing a new version of the project. 

### When adding/updating components
- [ ] **1. nunjucks file (adding only)**. Create an `njk` file for the macro in the directory `src\njk\elements`. Macro must have the same name as it's file. For example `backLink.njk` should have `{% macro backLink(params) -%}`
  - **Localized content**: 
    - Import localizer from utilities `{%- from "../utilities/govcyUtilities.njk" import govcyLocalizeContent, govcyLangAttribute, govcyGetContent -%}` 
    - For **standard localized content**, use `{{ govcyGetContent('componentName_key', params.lang) }}`. For example use in the component `backLink.njk` `{{ govcyGetContent('backLink_back', params.lang) }}`
      - Make sure to add the new content in the `govcyGetContent` macro in `/utilities/govcyUtilities.njk`. For example add ` backLink_back: {el: "Πίσω", en: "Back"},` to the `govcyContent` object.
    - For **dynamic localized content**, use `{{ govcyLocalizeContent(params.text, params.lang) }}` 
    - For the **`lang` attribute**, use `{{ govcyLangAttribute(params.lang) }}` (use this on the top level tag).
  - **Elements from array**: 
    - Import elements from utilities `{%- from "../utilities/govcyUtilities.njk" import govcyElementsFromArray -%}` 
    - Use `{{ govcyElementsFromArray(params.elements, params.lang) }}` to add elements from an array.
- [ ] **2. govcyElement.njk (adding only)**. Update the `src\njk\govcyElement.njk` file macro with the new component, by adding the macro name in either the `macroBlocks` or `callMacroBlocks` arrays.
- [ ] **3. test.njk**. Update the `test\test.njk` file with all variant of the new component. When possible, give a distinctive id, or text content for each variant. For example `{{ govcyElement("backLink",{text:{en:"Back EN govcy-test-53",el:"Πίσω EL"} }) }}`
- [ ] **4. test.json**. Update the `test\test.json` file with the same variant of the new component as `test\test.njk`. For example `{"element": "backLink", "params": { "text": { "en": "Back EN govcy-test-53", "el": "Πίσω EL" } } },`
 
### Always, test changes
- [ ] **5. update unit test script**. Update the `test\moca\unit.test.mjs` file with tests for all the created variants. 
- [ ] **6. re-build (Optional)**. Re-build by running `npm run build`
- [ ] **7. manually test**. View the rendered HTML on local host by running `npm start`
- [ ] **8. run unit tests**. Test by running `npm run test`

### Always, update version

- [ ] **9. update version number**. Update the `package.json` with a new version number.
- [ ] **10. update changelog**. Update the `CHANGELOG.md` with the changes.

### Document

- [ ] **11. update design elements documentation**. Update the `DESIGN_ELEMENTS.md` documenting the change.

-------

# Useful scripts

## Get event listeners

Get all the event listeners of the page. Must be run on *chrome console*, by running `getAllEventListeners(document)`. 

```js
function getAllEventListeners(element) {
  const allElements = element.getElementsByTagName("*");
  const allEvents = ["click", "input", "keyup", "change", "mouseover", "keydown", "focusout", "submit"];

  const events = [];
  for (let el of allElements) {
    for (let event of allEvents) {
      const listeners = getEventListeners(el)[event];
      if (listeners && listeners.length) {
        events.push({ element: el, event: event, listeners: listeners });
      }
    }
  }
  return events;
}
```