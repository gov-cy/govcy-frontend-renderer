<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
     
        <!-- CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/gov-cy/govcy-design-system@v3.1.0/dist/css/govcy.uds.min.css" integrity="sha384-Py9pPShU3OUzcQ3dAfZLkJI0Fgyv9fWKmAdK8f7dS9caBKuKs5z/ZpyERuh0ujm0" crossorigin="anonymous">
        
        <title>Page title - Service Name - gov.cy</title>
        <meta name="description" content="Description of what the service does">
     
     
      </head>
<body>
    <!--bodyStart-->
    <section class="govcy-container-fluid" id="bodyStartContainer">
        <a href="#mainContainer" class="govcy-skip-link">Skip to main content</a>
   </section>
     <!--main-->
     <main class="govcy-container" id="mainContainer">
        <div class="govcy-row">
            <article class="govcy-col-8">
                <div id="output" class="govcy-form"></div>
            </article>
        </div>
    </main>
  <script src="https://cdn.jsdelivr.net/gh/gov-cy/govcy-design-system@v3.1.0/dist/js/govcy.uds.min.js" integrity="sha384-g1c/YT97MWPoo9pbyFgQcxvB2MYLdsOgI2+ldxkEXAbhTzKfyYXCEjk9EVkOP5hp" crossorigin="anonymous"></script>
  <script src="/dist/govcyCompiledTemplates.browser.js"></script>
  <script src="/dist/govcyFrontendRenderer.browser.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async function() {
      // Ensure GovcyFrontendRendererBrowser is loaded before using it
      if (typeof GovcyFrontendRendererBrowser === 'undefined') {
        console.error('GovcyFrontendRendererBrowser is not defined');
      } else {
        console.log('GovcyFrontendRendererBrowser is loaded');
        // console.log('Precompiled templates:', window.nunjucksPrecompiled);

        // Create an instance of GovcyFrontendRendererBrowser
        const renderer = new GovcyFrontendRendererBrowser();

        // Define the input data
        const inputData = 
        {    
            "site" : {
                "lang" : "en"
            }
        };

        
        // Fetch the test.json file
        const response = await fetch('/test/test.json');
        const testJson = await response.json();
        // console.log('Loaded test.json:', testJson);
        // Construct the JSONTemplate
        const JSONTemplate = {
          "elements": []
        };
        // go through every section and add the elements to the JSONTemplate
        testJson.sections.forEach(section => {
          section.elements.forEach(element => {
            JSONTemplate.elements.push(element);
          });
        });

        // console.log('Constructed JSONTemplate:', JSONTemplate);
        let renderedHtml = renderer.renderFromJSON(JSONTemplate,inputData);
        document.getElementById('output').innerHTML += renderedHtml;

         // Re-initialize components manually
        document.querySelectorAll('.govcy-accordion-button').forEach((element) => {
          new GOVCY.Accordion(element);
        });

        document.querySelectorAll('.govcy-character-count').forEach((element) => {
          new GOVCY.CharacterCount(element);
        });

        document.querySelectorAll('.govcy-collapsable').forEach((element) => {
          new GOVCY.Collapsable(element);
        });

        document.querySelectorAll('.govcy-date-picker').forEach((element) => {
          new GOVCY.DatePicker(element);
        });

        document.querySelectorAll('.govcy-header').forEach((element) => {
          new GOVCY.HeaderMenu(element);
        });

        if ('OTPCredential' in window) {
          document.querySelectorAll('input[autocomplete="one-time-code"]').forEach((element) => {
            new GOVCY.MobileOTP(element);
          });
        }

        document.querySelectorAll('.govcy-tab-link').forEach((element) => {
          new GOVCY.Tab(element);
        });

        document.querySelectorAll('.govcy-radio-input').forEach((element) => {
          new GOVCY.ConditionalContactToggler(element);
        });
    }
});
  </script>
  </body>
</body>
</html>